create database AB_TREINAMENTO_Mariana;
use AB_TREINAMENTO_Mariana;

create table PESSOAS(
CODPESSOA varchar(3) NOT NULL,
CPFCNPJ  varchar(14) NOT NULL,
NOME   varchar(100) NOT NULL,
DATANASCIMENTO datetime NOT NULL,
TIPOPESSOA char(1) NOT NULL,
check(TIPOPESSOA in ('F','J')),
NUMEROFILHOS int default 0 NOT NULL,
INDCLIENTEBANCO char(1) NOT NULL,
check(INDCLIENTEBANCO in ('S','N')),
TIPOLOGRADOURO varchar(3),
LOGRADOURO varchar(100),
BAIRRO varchar(50),
CIDADE  varchar(50),
UF varchar(2),
PAIS varchar(50),
CEP char(8),
OBSERVACAO varchar(100),
PRIMARY KEY(CODPESSOA)

);

select * from pessoas;


use AB_TREINAMENTO_Mariana;
create table CONTAS(
CODCOLIGADA varchar(3) NOT NULL,
CODAGENCIA varchar(5) NOT NULL,
NROCONTA varchar(7) NOT NULL,
CODPESSOA varchar(3) NOT NULL,
INDPOUPANCA  char(1) NOT NULL,
check(INDPOUPANCA in ('S','N')),
USUARIOINCLUSAO varchar(100),
DATAINCLUSAO datetime,
USUARIOALTERACAO varchar(100),
CONSTRAINT pk_CONTAS PRIMARY KEY(CODCOLIGADA,CODAGENCIA,NROCONTA),
FOREIGN KEY (CODPESSOA) REFERENCES PESSOAS(CODPESSOA)
);

select * from CONTAS;

use AB_TREINAMENTO_Mariana;
create table MOVIMENTOS(
CODCOLIGADA varchar(3) NOT NULL,
CODAGENCIA varchar(5) NOT NULL,
NROCONTA varchar(7) NOT NULL,
NROMOVIMENTO int IDENTITY(1,1) NOT NULL,
DATAMOVIMENTO datetime NOT NULL,
VALOR NUMERIC(17,2),
MORA NUMERIC(17,2),
MULTA NUMERIC(17,2),
DESCONTO NUMERIC(17,2),
DESCRICAO NUMERIC(17,2),
CONSTRAINT pk_MOVIMENTOS PRIMARY KEY(CODCOLIGADA,CODAGENCIA,NROCONTA,NROMOVIMENTO),
FOREIGN KEY(CODCOLIGADA,CODAGENCIA,NROCONTA) REFERENCES CONTAS(CODCOLIGADA,CODAGENCIA,NROCONTA),

)
SELECT * FROM MOVIMENTOS;


INSERT into PESSOAS (CODPESSOA,CPFCNPJ,NOME,DATANASCIMENTO,TIPOPESSOA,NUMEROFILHOS,INDCLIENTEBANCO,
TIPOLOGRADOURO,LOGRADOURO,BAIRRO,CIDADE,UF,PAIS,CEP,OBSERVACAO)
VALUES ('1','42072606792','Mariana',CAST('23/05/2003' as date) ,'J','0','S','ca','FLORIANO PEIXOTO','CENTRO','BERNARDINO DE CAMPOS',
'SP','BRASIL','18960013','CASA MARIANA')


INSERT into PESSOAS (CODPESSOA,CPFCNPJ,NOME,DATANASCIMENTO,TIPOPESSOA,NUMEROFILHOS,INDCLIENTEBANCO,
TIPOLOGRADOURO,LOGRADOURO,BAIRRO,CIDADE,UF,PAIS,CEP,OBSERVACAO)
VALUES ('2','42074406643','JULIA',CAST('03/07/1998' as date), 'F','1','N','ca','13 de abril','vila Mariana','SÃ£o Paulo','SP',
'BRASIL','13432534','CASA JULIA')


INSERT into PESSOAS (CODPESSOA,CPFCNPJ,NOME,DATANASCIMENTO,TIPOPESSOA,NUMEROFILHOS,INDCLIENTEBANCO,
TIPOLOGRADOURO,LOGRADOURO,BAIRRO,CIDADE,UF,PAIS,CEP,OBSERVACAO)
values('3','42077732043','Augusto',cast('13/09/1985' as date),'F','3','S','ca','rua das castanhas','vila andrade','santa catarina',
'SC','BRASIL','12345678','CASA AUGUSTO')


update PESSOAS set
         NOME = 'Augusto Silva',
		 TIPOPESSOA = 'J',
		 LOGRADOURO = 'Rua das Flores',
		 DATANASCIMENTO = cast('10/01/1984' as date)
where CODPESSOA = 3;


delete from PESSOAS WHERE CODPESSOA = 3;
INSERT into CONTAS (CODCOLIGADA,CODAGENCIA,NROCONTA,CODPESSOA,INDPOUPANCA,USUARIOINCLUSAO,DATAINCLUSAO,USUARIOALTERACAO)
VALUES ('3','003','1434','1','n','MARIANA',GETDATE(),'MARIANA')

INSERT into CONTAS (CODCOLIGADA,CODAGENCIA,NROCONTA,CODPESSOA,INDPOUPANCA,USUARIOINCLUSAO,DATAINCLUSAO,USUARIOALTERACAO)
VALUES ('1','003','1234','1','S','MARIANA',GETDATE(),'MARIANA')


INSERT into CONTAS (CODCOLIGADA,CODAGENCIA,NROCONTA,CODPESSOA,INDPOUPANCA,USUARIOINCLUSAO,DATAINCLUSAO,USUARIOALTERACAO)
VALUES('2','004','233','2','N','MARIANA',GETDATE(),'MARIANA')

SELECT COUNT(CODPESSOA)
FROM PESSOAS;

SELECT NOME,
case TIPOPESSOA
when 'J' THEN 'JURIDICA'
when 'F' THEN 'FISICA'
END TIPOPESSOA
FROM PESSOAS;


select * from pessoas where datanascimento = (select min(datanascimento) from pessoas) 

select * from pessoas  WHERE UF IS NOT NULL AND CIDADE IS NOT NULL AND CIDADE !='' AND UF !='' ORDER BY CIDADE,UF;

select PESSOAS.NOME, CONTAS.NROCONTA  from pessoas

INNER JOIN Contas

     ON Pessoas.CODPESSOA = CONTAS.CODPESSOA;




SELECT * FROM CONTAS C LEFT JOIN PESSOAS P ON (P.CODPESSOA = C.CODPESSOA) WHERE (SELECT COUNT(*) FROM CONTAS WHERE CODPESSOA = P.CODPESSOA) > 1



select C.CODPESSOA,P.NOME,C.NROCONTA,  P.TIPOPESSOA
FROM CONTAS C LEFT JOIN PESSOAS P ON C.CODPESSOA = P.CODPESSOA GROUP BY C.CODPESSOA,P.NOME,C.NROCONTA, P.TIPOPESSOA HAVING P.TIPOPESSOA LIKE 'F'








